<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Page</title>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f9fafb;
            color: #333;
        }
    .delete{
        background-color: red;
    }
    .delete:hover{
        background-color: lightgoldenrodyellow;
        color: red;
    }
        h1 {
            text-align: center;
            margin-bottom: 30px;
            color: #2c3e50;
        }
    
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background: #fff;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }
    
        th, td {
            border: 1px solid #e0e0e0;
            padding: 12px 15px;
            text-align: left;
        }
    
        th {
            background-color: #34495e;
            color: #fff;
            text-transform: uppercase;
            font-size: 14px;
        }
    
        td {
            font-size: 14px;
            color: #555;
        }
    
        button {
            padding: 8px 15px;
            margin: 5px;
            cursor: pointer;
            background-color: #3498db;
            color: #fff;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
    
        button:hover {
            background-color: #2980b9;
            transform: scale(1.05);
        }
    
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
            padding: 20px;
            z-index: 1000;
            width: 90%;
            max-width: 400px;
        }
    
        .modal h2 {
            margin-top: 0;
            font-size: 20px;
            color: #2c3e50;
        }
    
        .modal input {
            display: block;
            margin: 10px 0;
            padding: 10px;
            width: calc(100% - 20px);
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
    
        .modal button {
            width: 100%;
            margin-top: 10px;
        }
    
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 999;
        }
    
        .btn-danger {
            background-color: #e74c3c;
        }
    
        .btn-danger:hover {
            background-color: #c0392b;
        }
    
        .btn-edit {
            background-color: #f1c40f;
            color: #333;
        }
    
        .btn-edit:hover {
            background-color: #d4ac0d;
        }
    </style>
    
</head>
<body>

<h1>Admin Page</h1>

<button id="addBusiness">Add Business</button>

<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Business Name</th>
            <th>Category</th>
            <th>Details</th>
            <th>Phone</th>
            <th>Email</th>
            <th>Address</th>
            <th>Website</th>
            <th>Person Photo</th>
            <th>Business Photo</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody id="businessTableBody">
        <!-- Dynamic rows will appear here -->
    </tbody>
</table>

<!-- Edit Modal -->
<div class="modal" id="editModal">
    <h2>Edit Business</h2>
    <input type="text" id="editName" placeholder="Name">
    <input type="text" id="editBusinessName" placeholder="Business Name">
    <input type="text" id="editCategory" placeholder="Category">
    <input type="text" id="editDetails" placeholder="Details">
    <input type="text" id="editPhone" placeholder="Phone">
    <input type="email" id="editEmail" placeholder="Email">
    <input type="text" id="editAddress" placeholder="Address">
    <input type="url" id="editWebsite" placeholder="Website">
    <label>Person Photo:</label>
    <input type="file" id="editPersonPhoto">
    <label>Business Photo:</label>
    <input type="file" id="editBusinessPhoto">
    <button id="saveEdit">Save Changes</button>
    <button id="closeModal">Cancel</button>
</div>

<div class="overlay" id="overlay" style="display: none;"></div>






<script>
    const businessTableBody = document.getElementById("businessTableBody");
    const editModal = document.getElementById("editModal");
    const overlay = document.getElementById("overlay");
    const saveEditButton = document.getElementById("saveEdit");
    const closeModalButton = document.getElementById("closeModal");
    let editIndex = null;

    // Display data from localStorage
    const displayData = () => {
        const data = JSON.parse(localStorage.getItem("businessData")) || [];
        businessTableBody.innerHTML = ""; // Clear the table
        data.forEach((business, index) => {
            businessTableBody.innerHTML += `
                <tr>
                    <td>${business.name}</td>
                    <td>${business.businessName}</td>
                    <td>${business.category}</td>
                    <td>${business.details}</td>
                    <td>${business.phone}</td>
                    <td>${business.email}</td>
                    <td>${business.address}</td>
                    <td><a href="${business.website}" target="_blank">${business.website}</a></td>
                    <td><img src="${business.personPhoto}" alt="Person" width="50"></td>
                    <td><img src="${business.businessPhoto}" alt="Business" width="50"></td>
                                       

                    <td>
                        <button onclick="editBusiness(${index})">Edit</button>
                        <button class="delete" onclick="deleteBusiness(${index})">Delete</button>
                    </td>
                </tr>
            `;
        });
    };

// Save changes to business
saveEditButton.addEventListener("click", () => {
    const data = JSON.parse(localStorage.getItem("businessData")) || [];
    
    // Function to convert image file to base64 string
    const convertImageToBase64 = (file) => {
        return new Promise((resolve) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result);
            reader.readAsDataURL(file);
        });
    };

    // Initialize the updatedBusiness object with the form data
    const updatedBusiness = {
        name: document.getElementById("editName").value,
        businessName: document.getElementById("editBusinessName").value,
        category: document.getElementById("editCategory").value,
        details: document.getElementById("editDetails").value,
        phone: document.getElementById("editPhone").value,
        email: document.getElementById("editEmail").value,
        address: document.getElementById("editAddress").value,
        website: document.getElementById("editWebsite").value,
        // Handle image file conversion if a new file is selected
        personPhoto: document.getElementById("editPersonPhoto").files[0]
            ? convertImageToBase64(document.getElementById("editPersonPhoto").files[0])
            : Promise.resolve(data[editIndex].personPhoto), // Keep old photo if no new file is selected
        businessPhoto: document.getElementById("editBusinessPhoto").files[0]
            ? convertImageToBase64(document.getElementById("editBusinessPhoto").files[0])
            : Promise.resolve(data[editIndex].businessPhoto), // Keep old photo if no new file is selected
    };

    // Wait for images to be converted before saving data
    Promise.all([updatedBusiness.personPhoto, updatedBusiness.businessPhoto])
        .then(([personPhoto, businessPhoto]) => {
            updatedBusiness.personPhoto = personPhoto;
            updatedBusiness.businessPhoto = businessPhoto;

            // Update the data
            data[editIndex] = updatedBusiness;
            localStorage.setItem("businessData", JSON.stringify(data));
            
            // Close modal and overlay
            editModal.style.display = "none";
            overlay.style.display = "none";
            
            // Refresh the table data
            displayData();
        })
        .catch((error) => {
            console.error("Error converting images:", error);
        });
});


    // Add new business
    document.getElementById("addBusiness").addEventListener("click", () => {
        const newBusinessData = {
            name: "New Name",
            businessName: "New Business Name",
            category: "New Category",
            details: "New Details",
            phone: "1234567890",
            email: "example@example.com",
            address: "New Address",
            website: "http://example.com",
            personPhoto: "https://via.placeholder.com/150",
            businessPhoto: "https://via.placeholder.com/150"
        };

        const data = JSON.parse(localStorage.getItem("businessData")) || [];
        data.push(newBusinessData);
        localStorage.setItem("businessData", JSON.stringify(data));
        displayData();
    });

    // Edit business
    const editBusiness = (index) => {
        editIndex = index;
        const data = JSON.parse(localStorage.getItem("businessData")) || [];
        const business = data[index];

        document.getElementById("editName").value = business.name;
        document.getElementById("editBusinessName").value = business.businessName;
        document.getElementById("editCategory").value = business.category;
        document.getElementById("editDetails").value = business.details;
        document.getElementById("editPhone").value = business.phone;
        document.getElementById("editEmail").value = business.email;
        document.getElementById("editAddress").value = business.address;
        document.getElementById("editWebsite").value = business.website;
        document.getElementById("editPersonPhoto").value = "";
        document.getElementById("editBusinessPhoto").value = "";

        editModal.style.display = "block";
        overlay.style.display = "block";
    };

    // Save edited business data
    saveEditButton.addEventListener("click", () => {
        const data = JSON.parse(localStorage.getItem("businessData")) || [];
        const updatedBusiness = {
            name: document.getElementById("editName").value,
            businessName: document.getElementById("editBusinessName").value,
            category: document.getElementById("editCategory").value,
            details: document.getElementById("editDetails").value,
            phone: document.getElementById("editPhone").value,
            email: document.getElementById("editEmail").value,
            address: document.getElementById("editAddress").value,
            website: document.getElementById("editWebsite").value,
            personPhoto: document.getElementById("editPersonPhoto").files[0]
                ? URL.createObjectURL(document.getElementById("editPersonPhoto").files[0])
                : data[editIndex].personPhoto,
            businessPhoto: document.getElementById("editBusinessPhoto").files[0]
                ? URL.createObjectURL(document.getElementById("editBusinessPhoto").files[0])
                : data[editIndex].businessPhoto,
        };

        // Update the photo and other business data
        data[editIndex] = updatedBusiness;
        localStorage.setItem("businessData", JSON.stringify(data));
        
        // Close the modal and overlay
        editModal.style.display = "none";
        overlay.style.display = "none";

        // Refresh the table data
        displayData();
    });

    // Close the modal
    closeModalButton.addEventListener("click", () => {
        editModal.style.display = "none";
        overlay.style.display = "none";
    });

    // Delete business
    const deleteBusiness = (index) => {
        const data = JSON.parse(localStorage.getItem("businessData")) || [];
        data.splice(index, 1);
        localStorage.setItem("businessData", JSON.stringify(data));
        displayData();
    };

    // Display data on page load
    window.onload = displayData;





    
</script>

</body>
</html>
